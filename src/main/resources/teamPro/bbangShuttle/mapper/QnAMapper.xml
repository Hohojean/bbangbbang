<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="teamPro.bbangShuttle.mapper.QnAMapper">

    <!-- CRUD SQL문 -->
    <select id="selectList" resultType="QnAVO">
        <![CDATA[
        SELECT
            qnaNo, userID, qnaTitle, qnaContent, qna_root, qna_step, qna_child, regDate
        FROM
            qna
        order by qna_root desc, qna_step asc
        ]]>
    </select>

    <select id="selectOne" resultType="QnAVO">
        select * from qna where qnaNo=${qnaNo}
    </select>

    <insert id="insert">
        <selectKey keyProperty="qnaNo" resultType="int" order="BEFORE"  >
            select IFNULL(max(qnaNo),0)+1 from qna
        </selectKey>
        insert into qna(userID, qnaTitle, qnaContent, regDate)
        values ( #{userID}, #{qnaTitle}, #{qnaContent}, NOW())
    </insert>

    <!-- Reply_Insert -->
    <insert id="rinsert">
        <selectKey keyProperty="seq" resultType="int" order="BEFORE">
            select IFNULL(max(seq),0)+1 from board
        </selectKey>
        insert into board(seq,id,title,content,root,step,indent)
        values(#{seq},#{id},#{title},#{content},#{root},#{step},#{indent})
    </insert>
    <update id="stepUpdate">
        <selectKey keyProperty="seq" resultType="int" order="BEFORE">
            select max(seq) from board
        </selectKey>
        update board set step=step+1
        where root=#{root} and step>=#{step} and seq != #{seq}
    </update>

    <delete id="delete">
        delete from qna
        <if test="qnaNo==qna_root">where qnaNo=#{qnaNo}</if>
        <!-- 원글 삭제 : 동일 root 는 모두 삭제 -->
        <if test="qnaNo!=qna_root">where qnaNo=#{qnaNo}</if>
        <!-- 답글만 삭제 -->
    </delete>
    
</mapper>